# name: Deploy
#
# on:
#   workflow_run:
#     workflows: ["CI"]
#     types:
#       - completed
#
# jobs:
#   deploy:
#     if: ${{ github.event.workflow_run.conclusion == 'success' }}
#     runs-on: ubuntu-latest
#     env:
#       NODE_ENV: ${{ secrets.CI_NODE_ENV }}
#
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4
#
#       - name: Setup Bun
#         uses: oven-sh/setup-bun@v2
#         with:
#           bun-version: latest
#
#       - name: Deploy to server
#         uses: appleboy/ssh-action@v0.1.6
#         with:
#           host: ${{ secrets.SERVER_HOST }}
#           username: ${{ secrets.SERVER_USER }}
#           key: ${{ secrets.SERVER_SSH_KEY }}
#           port: ${{ secrets.SERVER_PORT }}
#           script: |
#             export PATH="$HOME/.bun/bin:$PATH"
#             export NODE_ENV=production
#
#             cd binspire
#             git fetch origin main && git reset --hard origin/main
#
#             bun install --force
#
#             bun run build
#
#             pm2 delete binspire-api || true
#             pm2 start "bun run prod" --name binspire-api --cwd ~/binspire/apps/api --env production
#
#             sudo nginx -t && sudo systemctl reload nginx
